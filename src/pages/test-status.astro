---
import { getCollection } from 'astro:content';

let articleCount = 0;
let errorMessage = null;

try {
  const articles = await getCollection('blog');
  articleCount = articles.length;
} catch (error) {
  errorMessage = error.message;
}
---

<html lang="it">
  <head>
    <meta charset="utf-8" />
    <title>Test Status - Ombre e Luci</title>
    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        line-height: 1.6;
      }
      .status {
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .info {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
      }
      h1 {
        color: #333;
      }
      a {
        color: #0066cc;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <h1>Test Status Server</h1>
    
    {errorMessage ? (
      <div class="status error">
        <strong>❌ Errore:</strong> {errorMessage}
      </div>
    ) : (
      <div class="status success">
        <strong>✅ Server Funzionante!</strong>
        <p>Articoli caricati: <strong>{articleCount}</strong></p>
      </div>
    )}
    
    <div class="status info">
      <h3>Link di Test:</h3>
      <ul>
        <li><a href="/">Home (Archivio)</a></li>
        <li><a href="/test-lista">Lista Completa Articoli</a></li>
        {articleCount > 0 && (
          <li><a href="/blog/ombre-e-luci">Test Articolo: "Ombre e luci?"</a></li>
        )}
      </ul>
    </div>
    
    <div class="status info">
      <h3>Info Sistema:</h3>
      <ul>
        <li>Server: Astro Dev</li>
        <li>Porta: 4321</li>
        <li>URL: <a href="http://localhost:4321">http://localhost:4321</a></li>
      </ul>
    </div>
  </body>
</html>

